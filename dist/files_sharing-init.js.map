{"version":3,"file":"files_sharing-init.js?v=0f80edff41c8e11a5f6c","mappings":";;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACnIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;AACA;AACA;AACA;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACNA;AACA;AACA;AACA;AACA;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AClDA;;;;;AEAA;AACA;AACA;AACA;AACA","sources":["webpack:///nextcloud/apps/files/src/logger.js","webpack:///nextcloud/apps/files/src/actions/sidebarAction.ts","webpack:///nextcloud/apps/files_sharing/src/actions/acceptShareAction.ts","webpack:///nextcloud/apps/files_sharing/src/actions/openInFilesAction.ts","webpack:///nextcloud/apps/files_sharing/src/actions/rejectShareAction.ts","webpack:///nextcloud/apps/files_sharing/src/actions/restoreShareAction.ts","webpack:///nextcloud/apps/files_sharing/src/actions/sharingStatusAction.ts","webpack:///nextcloud/apps/files_sharing/src/init.ts","webpack:///nextcloud/apps/files_sharing/src/services/SharingService.ts","webpack:///nextcloud/apps/files_sharing/src/services/logger.ts","webpack:///nextcloud/apps/files_sharing/src/views/shares.ts","webpack:///nextcloud/apps/files_sharing/src/actions/sharingStatusAction.scss","webpack://nextcloud/./apps/files_sharing/src/actions/sharingStatusAction.scss?3ea7","webpack:///nextcloud/webpack/bootstrap","webpack:///nextcloud/webpack/runtime/chunk loaded","webpack:///nextcloud/webpack/runtime/compat get default export","webpack:///nextcloud/webpack/runtime/define property getters","webpack:///nextcloud/webpack/runtime/ensure chunk","webpack:///nextcloud/webpack/runtime/global","webpack:///nextcloud/webpack/runtime/hasOwnProperty shorthand","webpack:///nextcloud/webpack/runtime/make namespace object","webpack:///nextcloud/webpack/runtime/node module decorator","webpack:///nextcloud/webpack/runtime/jsonp chunk loading","webpack:///nextcloud/webpack/runtime/nonce","webpack:///nextcloud/webpack/before-startup","webpack:///nextcloud/webpack/startup","webpack:///nextcloud/webpack/after-startup"],"sourcesContent":["/**\n * @copyright Copyright (c) 2022 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { getLoggerBuilder } from '@nextcloud/logger';\nexport default getLoggerBuilder().setApp('files').detectUser().build();","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { Permission, FileAction } from '@nextcloud/files';\nimport { translate as t } from '@nextcloud/l10n';\nimport InformationSvg from '@mdi/svg/svg/information-variant.svg?raw';\nimport logger from '../logger.js';\nexport const ACTION_DETAILS = 'details';\nexport const action = new FileAction({\n  id: ACTION_DETAILS,\n  displayName: () => t('files', 'Open details'),\n  iconSvgInline: () => InformationSvg,\n  // Sidebar currently supports user folder only, /files/USER\n  enabled: nodes => {\n    // Only works on single node\n    if (nodes.length !== 1) {\n      return false;\n    }\n    if (!nodes[0]) {\n      return false;\n    }\n    // Only work if the sidebar is available\n    if (!window?.OCA?.Files?.Sidebar) {\n      return false;\n    }\n    return (nodes[0].root?.startsWith('/files/') && nodes[0].permissions !== Permission.NONE) ?? false;\n  },\n  async exec(node, view, dir) {\n    try {\n      // TODO: migrate Sidebar to use a Node instead\n      await window.OCA.Files.Sidebar.open(node.path);\n      // Silently update current fileid\n      window.OCP.Files.Router.goToRoute(null, {\n        view: view.id,\n        fileid: node.fileid\n      }, {\n        dir\n      }, true);\n      return null;\n    } catch (error) {\n      logger.error('Error while opening sidebar', {\n        error\n      });\n      return false;\n    }\n  },\n  order: -50\n});","import { emit } from '@nextcloud/event-bus';\nimport { generateOcsUrl } from '@nextcloud/router';\nimport { registerFileAction, FileAction } from '@nextcloud/files';\nimport { translatePlural as n } from '@nextcloud/l10n';\nimport axios from '@nextcloud/axios';\nimport CheckSvg from '@mdi/svg/svg/check.svg?raw';\nimport { pendingSharesViewId } from '../views/shares';\nexport const action = new FileAction({\n  id: 'accept-share',\n  displayName: nodes => n('files_sharing', 'Accept share', 'Accept shares', nodes.length),\n  iconSvgInline: () => CheckSvg,\n  enabled: (nodes, view) => nodes.length > 0 && view.id === pendingSharesViewId,\n  async exec(node) {\n    try {\n      const isRemote = !!node.attributes.remote;\n      const url = generateOcsUrl('apps/files_sharing/api/v1/{shareBase}/pending/{id}', {\n        shareBase: isRemote ? 'remote_shares' : 'shares',\n        id: node.attributes.id\n      });\n      await axios.post(url);\n      // Remove from current view\n      emit('files:node:deleted', node);\n      return true;\n    } catch (error) {\n      return false;\n    }\n  },\n  async execBatch(nodes, view, dir) {\n    return Promise.all(nodes.map(node => this.exec(node, view, dir)));\n  },\n  order: 1,\n  inline: () => true\n});\nregisterFileAction(action);","import { registerFileAction, FileAction, DefaultType } from '@nextcloud/files';\nimport { translate as t } from '@nextcloud/l10n';\nimport { sharesViewId, sharedWithYouViewId, sharedWithOthersViewId, sharingByLinksViewId } from '../views/shares';\nexport const action = new FileAction({\n  id: 'open-in-files',\n  displayName: () => t('files', 'Open in Files'),\n  iconSvgInline: () => '',\n  enabled: (nodes, view) => [sharesViewId, sharedWithYouViewId, sharedWithOthersViewId, sharingByLinksViewId\n  // Deleted and pending shares are not\n  // accessible in the files app.\n  ].includes(view.id),\n  async exec(node) {\n    window.OCP.Files.Router.goToRoute(null,\n    // use default route\n    {\n      view: 'files',\n      fileid: node.fileid\n    }, {\n      dir: node.dirname\n    });\n    return null;\n  },\n  // Before openFolderAction\n  order: -1000,\n  default: DefaultType.HIDDEN\n});\nregisterFileAction(action);","import { emit } from '@nextcloud/event-bus';\nimport { generateOcsUrl } from '@nextcloud/router';\nimport { registerFileAction, FileAction } from '@nextcloud/files';\nimport { translatePlural as n } from '@nextcloud/l10n';\nimport axios from '@nextcloud/axios';\nimport CloseSvg from '@mdi/svg/svg/close.svg?raw';\nimport { pendingSharesViewId } from '../views/shares';\nexport const action = new FileAction({\n  id: 'reject-share',\n  displayName: nodes => n('files_sharing', 'Reject share', 'Reject shares', nodes.length),\n  iconSvgInline: () => CloseSvg,\n  enabled: (nodes, view) => {\n    if (view.id !== pendingSharesViewId) {\n      return false;\n    }\n    if (nodes.length === 0) {\n      return false;\n    }\n    // disable rejecting group shares from the pending list because they anyway\n    // land back into that same list after rejecting them\n    if (nodes.some(node => node.attributes.remote_id && node.attributes.share_type === window.OC.Share.SHARE_TYPE_REMOTE_GROUP)) {\n      return false;\n    }\n    return true;\n  },\n  async exec(node) {\n    try {\n      const isRemote = !!node.attributes.remote;\n      const url = generateOcsUrl('apps/files_sharing/api/v1/{shareBase}/{id}', {\n        shareBase: isRemote ? 'remote_shares' : 'shares',\n        id: node.attributes.id\n      });\n      await axios.delete(url);\n      // Remove from current view\n      emit('files:node:deleted', node);\n      return true;\n    } catch (error) {\n      return false;\n    }\n  },\n  async execBatch(nodes, view, dir) {\n    return Promise.all(nodes.map(node => this.exec(node, view, dir)));\n  },\n  order: 2,\n  inline: () => true\n});\nregisterFileAction(action);","import { emit } from '@nextcloud/event-bus';\nimport { FileAction, registerFileAction } from '@nextcloud/files';\nimport { generateOcsUrl } from '@nextcloud/router';\nimport { translatePlural as n } from '@nextcloud/l10n';\nimport ArrowULeftTopSvg from '@mdi/svg/svg/arrow-u-left-top.svg?raw';\nimport axios from '@nextcloud/axios';\nimport { deletedSharesViewId } from '../views/shares';\nexport const action = new FileAction({\n  id: 'restore-share',\n  displayName: nodes => n('files_sharing', 'Restore share', 'Restore shares', nodes.length),\n  iconSvgInline: () => ArrowULeftTopSvg,\n  enabled: (nodes, view) => nodes.length > 0 && view.id === deletedSharesViewId,\n  async exec(node) {\n    try {\n      const url = generateOcsUrl('apps/files_sharing/api/v1/deletedshares/{id}', {\n        id: node.attributes.id\n      });\n      await axios.post(url);\n      // Remove from current view\n      emit('files:node:deleted', node);\n      return true;\n    } catch (error) {\n      return false;\n    }\n  },\n  async execBatch(nodes, view, dir) {\n    return Promise.all(nodes.map(node => this.exec(node, view, dir)));\n  },\n  order: 1,\n  inline: () => true\n});\nregisterFileAction(action);","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { registerFileAction, FileAction, Permission } from '@nextcloud/files';\nimport { translate as t } from '@nextcloud/l10n';\nimport { Type } from '@nextcloud/sharing';\nimport AccountGroupSvg from '@mdi/svg/svg/account-group.svg?raw';\nimport AccountPlusSvg from '@mdi/svg/svg/account-plus.svg?raw';\nimport LinkSvg from '@mdi/svg/svg/link.svg?raw';\nimport CircleSvg from '../../../../core/img/apps/circles.svg?raw';\nimport { action as sidebarAction } from '../../../files/src/actions/sidebarAction';\nimport { generateUrl } from '@nextcloud/router';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport './sharingStatusAction.scss';\nconst generateAvatarSvg = userId => {\n  const avatarUrl = generateUrl('/avatar/{userId}/32', {\n    userId\n  });\n  return `<svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\"\n\t\txmlns=\"http://www.w3.org/2000/svg\" class=\"sharing-status__avatar\">\n\t\t<image href=\"${avatarUrl}\" height=\"32\" width=\"32\" />\n\t</svg>`;\n};\nexport const action = new FileAction({\n  id: 'sharing-status',\n  displayName(nodes) {\n    const node = nodes[0];\n    const shareTypes = Object.values(node?.attributes?.['share-types'] || {}).flat();\n    const ownerId = node?.attributes?.['owner-id'];\n    if (shareTypes.length > 0 || ownerId && ownerId !== getCurrentUser()?.uid) {\n      return t('files_sharing', 'Shared');\n    }\n    return '';\n  },\n  title(nodes) {\n    const node = nodes[0];\n    const ownerId = node?.attributes?.['owner-id'];\n    const ownerDisplayName = node?.attributes?.['owner-display-name'];\n    if (ownerId && ownerId !== getCurrentUser()?.uid) {\n      return t('files_sharing', 'Shared by {ownerDisplayName}', {\n        ownerDisplayName\n      });\n    }\n    return t('files_sharing', 'Show sharing options');\n  },\n  iconSvgInline(nodes) {\n    const node = nodes[0];\n    const shareTypes = Object.values(node?.attributes?.['share-types'] || {}).flat();\n    // Link shares\n    if (shareTypes.includes(Type.SHARE_TYPE_LINK) || shareTypes.includes(Type.SHARE_TYPE_EMAIL)) {\n      return LinkSvg;\n    }\n    // Group shares\n    if (shareTypes.includes(Type.SHARE_TYPE_GROUP) || shareTypes.includes(Type.SHARE_TYPE_REMOTE_GROUP)) {\n      return AccountGroupSvg;\n    }\n    // Circle shares\n    if (shareTypes.includes(Type.SHARE_TYPE_CIRCLE)) {\n      return CircleSvg;\n    }\n    const ownerId = node?.attributes?.['owner-id'];\n    if (ownerId && ownerId !== getCurrentUser()?.uid) {\n      return generateAvatarSvg(ownerId);\n    }\n    return AccountPlusSvg;\n  },\n  enabled(nodes) {\n    if (nodes.length !== 1) {\n      return false;\n    }\n    const node = nodes[0];\n    const ownerId = node?.attributes?.['owner-id'];\n    if (ownerId && ownerId !== getCurrentUser()?.uid) {\n      return true;\n    }\n    return (node.permissions & Permission.SHARE) !== 0;\n  },\n  async exec(node, view, dir) {\n    // You need read permissions to see the sidebar\n    if ((node.permissions & Permission.READ) !== 0) {\n      window.OCA?.Files?.Sidebar?.setActiveTab?.('sharing');\n      return sidebarAction.exec(node, view, dir);\n    }\n    return null;\n  },\n  inline: () => true\n});\nregisterFileAction(action);","/**\n * @copyright Copyright (c) 2019 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Julius Härtl <jus@bitgrid.net>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport registerSharingViews from './views/shares';\nimport './actions/acceptShareAction';\nimport './actions/openInFilesAction';\nimport './actions/rejectShareAction';\nimport './actions/restoreShareAction';\nimport './actions/sharingStatusAction';\nregisterSharingViews();","import { Folder, File } from '@nextcloud/files';\nimport { generateOcsUrl, generateRemoteUrl } from '@nextcloud/router';\nimport { getCurrentUser } from '@nextcloud/auth';\nimport axios from '@nextcloud/axios';\nimport logger from './logger';\nexport const rootPath = `/files/${getCurrentUser()?.uid}`;\nconst headers = {\n  'Content-Type': 'application/json'\n};\nconst ocsEntryToNode = function (ocsEntry) {\n  try {\n    const isFolder = ocsEntry?.item_type === 'folder';\n    const hasPreview = ocsEntry?.has_preview === true;\n    const Node = isFolder ? Folder : File;\n    const fileid = ocsEntry.file_source;\n    // Generate path and strip double slashes\n    const path = ocsEntry?.path || ocsEntry.file_target;\n    const source = generateRemoteUrl(`dav/${rootPath}/${path}`.replaceAll(/\\/\\//gm, '/'));\n    // Prefer share time if more recent than item mtime\n    let mtime = ocsEntry?.item_mtime ? new Date(ocsEntry.item_mtime * 1000) : undefined;\n    if (ocsEntry?.stime > (ocsEntry?.item_mtime || 0)) {\n      mtime = new Date(ocsEntry.stime * 1000);\n    }\n    return new Node({\n      id: fileid,\n      source,\n      owner: ocsEntry?.uid_owner,\n      mime: ocsEntry?.mimetype,\n      mtime,\n      size: ocsEntry?.item_size,\n      permissions: ocsEntry?.item_permissions || ocsEntry?.permissions,\n      root: rootPath,\n      attributes: {\n        ...ocsEntry,\n        'has-preview': hasPreview,\n        favorite: ocsEntry?.tags?.includes(window.OC.TAG_FAVORITE) ? 1 : 0\n      }\n    });\n  } catch (error) {\n    logger.error('Error while parsing OCS entry', {\n      error\n    });\n    return null;\n  }\n};\nconst getShares = function () {\n  let shared_with_me = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n  const url = generateOcsUrl('apps/files_sharing/api/v1/shares');\n  return axios.get(url, {\n    headers,\n    params: {\n      shared_with_me,\n      include_tags: true\n    }\n  });\n};\nconst getSharedWithYou = function () {\n  return getShares(true);\n};\nconst getSharedWithOthers = function () {\n  return getShares();\n};\nconst getRemoteShares = function () {\n  const url = generateOcsUrl('apps/files_sharing/api/v1/remote_shares');\n  return axios.get(url, {\n    headers,\n    params: {\n      include_tags: true\n    }\n  });\n};\nconst getPendingShares = function () {\n  const url = generateOcsUrl('apps/files_sharing/api/v1/shares/pending');\n  return axios.get(url, {\n    headers,\n    params: {\n      include_tags: true\n    }\n  });\n};\nconst getRemotePendingShares = function () {\n  const url = generateOcsUrl('apps/files_sharing/api/v1/remote_shares/pending');\n  return axios.get(url, {\n    headers,\n    params: {\n      include_tags: true\n    }\n  });\n};\nconst getDeletedShares = function () {\n  const url = generateOcsUrl('apps/files_sharing/api/v1/deletedshares');\n  return axios.get(url, {\n    headers,\n    params: {\n      include_tags: true\n    }\n  });\n};\nexport const getContents = async function () {\n  let sharedWithYou = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n  let sharedWithOthers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  let pendingShares = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  let deletedshares = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  let filterTypes = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];\n  const promises = [];\n  if (sharedWithYou) {\n    promises.push(getSharedWithYou(), getRemoteShares());\n  }\n  if (sharedWithOthers) {\n    promises.push(getSharedWithOthers());\n  }\n  if (pendingShares) {\n    promises.push(getPendingShares(), getRemotePendingShares());\n  }\n  if (deletedshares) {\n    promises.push(getDeletedShares());\n  }\n  const responses = await Promise.all(promises);\n  const data = responses.map(response => response.data.ocs.data).flat();\n  let contents = data.map(ocsEntryToNode).filter(node => node !== null);\n  if (filterTypes.length > 0) {\n    contents = contents.filter(node => filterTypes.includes(node.attributes?.share_type));\n  }\n  return {\n    folder: new Folder({\n      id: 0,\n      source: generateRemoteUrl('dav' + rootPath),\n      owner: getCurrentUser()?.uid || null\n    }),\n    contents\n  };\n};","/**\n * @copyright Copyright (c) 2022 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { getLoggerBuilder } from '@nextcloud/logger';\nexport default getLoggerBuilder().setApp('files_sharing').detectUser().build();","/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { translate as t } from '@nextcloud/l10n';\nimport { View, getNavigation } from '@nextcloud/files';\nimport AccountClockSvg from '@mdi/svg/svg/account-clock.svg?raw';\nimport AccountGroupSvg from '@mdi/svg/svg/account-group.svg?raw';\nimport AccountPlusSvg from '@mdi/svg/svg/account-plus.svg?raw';\nimport AccountSvg from '@mdi/svg/svg/account.svg?raw';\nimport DeleteSvg from '@mdi/svg/svg/delete.svg?raw';\nimport LinkSvg from '@mdi/svg/svg/link.svg?raw';\nimport { getContents } from '../services/SharingService';\nexport const sharesViewId = 'shareoverview';\nexport const sharedWithYouViewId = 'sharingin';\nexport const sharedWithOthersViewId = 'sharingout';\nexport const sharingByLinksViewId = 'sharinglinks';\nexport const deletedSharesViewId = 'deletedshares';\nexport const pendingSharesViewId = 'pendingshares';\nexport default (() => {\n  const Navigation = getNavigation();\n  Navigation.register(new View({\n    id: sharesViewId,\n    name: t('files_sharing', 'Shares'),\n    caption: t('files_sharing', 'Overview of shared files.'),\n    emptyTitle: t('files_sharing', 'No shares'),\n    emptyCaption: t('files_sharing', 'Files and folders you shared or have been shared with you will show up here'),\n    icon: AccountPlusSvg,\n    order: 20,\n    columns: [],\n    getContents: () => getContents()\n  }));\n  Navigation.register(new View({\n    id: sharedWithYouViewId,\n    name: t('files_sharing', 'Shared with you'),\n    caption: t('files_sharing', 'List of files that are shared with you.'),\n    emptyTitle: t('files_sharing', 'Nothing shared with you yet'),\n    emptyCaption: t('files_sharing', 'Files and folders others shared with you will show up here'),\n    icon: AccountSvg,\n    order: 1,\n    parent: sharesViewId,\n    columns: [],\n    getContents: () => getContents(true, false, false, false)\n  }));\n  Navigation.register(new View({\n    id: sharedWithOthersViewId,\n    name: t('files_sharing', 'Shared with others'),\n    caption: t('files_sharing', 'List of files that you shared with others.'),\n    emptyTitle: t('files_sharing', 'Nothing shared yet'),\n    emptyCaption: t('files_sharing', 'Files and folders you shared will show up here'),\n    icon: AccountGroupSvg,\n    order: 2,\n    parent: sharesViewId,\n    columns: [],\n    getContents: () => getContents(false, true, false, false)\n  }));\n  Navigation.register(new View({\n    id: sharingByLinksViewId,\n    name: t('files_sharing', 'Shared by link'),\n    caption: t('files_sharing', 'List of files that are shared by link.'),\n    emptyTitle: t('files_sharing', 'No shared links'),\n    emptyCaption: t('files_sharing', 'Files and folders you shared by link will show up here'),\n    icon: LinkSvg,\n    order: 3,\n    parent: sharesViewId,\n    columns: [],\n    getContents: () => getContents(false, true, false, false, [window.OC.Share.SHARE_TYPE_LINK])\n  }));\n  Navigation.register(new View({\n    id: deletedSharesViewId,\n    name: t('files_sharing', 'Deleted shares'),\n    caption: t('files_sharing', 'List of shares you left.'),\n    emptyTitle: t('files_sharing', 'No deleted shares'),\n    emptyCaption: t('files_sharing', 'Shares you have left will show up here'),\n    icon: DeleteSvg,\n    order: 4,\n    parent: sharesViewId,\n    columns: [],\n    getContents: () => getContents(false, false, false, true)\n  }));\n  Navigation.register(new View({\n    id: pendingSharesViewId,\n    name: t('files_sharing', 'Pending shares'),\n    caption: t('files_sharing', 'List of unapproved shares.'),\n    emptyTitle: t('files_sharing', 'No pending shares'),\n    emptyCaption: t('files_sharing', 'Shares you have received but not approved will show up here'),\n    icon: AccountClockSvg,\n    order: 5,\n    parent: sharesViewId,\n    columns: [],\n    getContents: () => getContents(false, false, true, false)\n  }));\n});","// Imports\nimport ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/noSourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `@charset \"UTF-8\";\n/**\n * @copyright Copyright (c) 2023 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n.action-items > .files-list__row-action-sharing-status {\n  direction: rtl;\n  padding-right: 0 !important;\n}\n\nsvg.sharing-status__avatar {\n  height: 32px !important;\n  width: 32px !important;\n  border-radius: 32px;\n  overflow: hidden;\n}`, \"\"]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/sass-loader/dist/cjs.js!./sharingStatusAction.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/sass-loader/dist/cjs.js!./sharingStatusAction.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","// The chunk loading function for additional chunks\n// Since all referenced chunks are already included\n// in this file, this function is empty here.\n__webpack_require__.e = () => (Promise.resolve());","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"files_sharing-init\": 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunknextcloud\"] = self[\"webpackChunknextcloud\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","__webpack_require__.nc = undefined;","","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [\"core-common\"], () => (__webpack_require__(\"./apps/files_sharing/src/init.ts\")))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n",""],"names":[],"sourceRoot":""}